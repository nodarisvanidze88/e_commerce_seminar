name: Deploy my project

on:
    push:
        branches:
            - main

jobs:
    deploy:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v2

            - name: set up ssh
              uses: webfactory/ssh-agent@v0.5.3
              with:
                  ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}
            - name: Create Infrastructure
              run: |
                  ssh -o StrictHostKeyChecking=no root@207.154.242.51 <<EOF
                  if [ ! -d "/app" ]; then
                      mkdir -p /app
                  fi
                  cd /app
                  sudo apt update
                  sudo apt install -y python3-venv python3-pip gunicorn
                  git clone https://github.com/nodarisvanidze88/e_commerce_seminar.git .
                  EOF
